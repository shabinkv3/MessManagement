<!DOCTYPE html>
<html lang="en">
<head>

<%= javascript_include_tag 'application' %>
<meta charset="UTF-8">
<%= csrf_meta_tag %>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grid</title>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core@next/dist/ionic/ionic.esm.js"></script>
  <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core@next/dist/ionic/ionic.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core@next/css/ionic.bundle.css"/>
    <script type="module">
    import { toastController } from 'https://cdn.jsdelivr.net/npm/@ionic/core@next/dist/ionic/index.esm.js';
    window.toastController = toastController;
</script>
  <style>
    .extraToast
    {
        --background: green;
    }
    ion-item.side_tabs.item:hover {
  --ion-background-color: #a179d5 !important;
  border-radius: 4px;
    }
    ion-item.active.item:hover {
  --ion-background-color: #b88eed !important;
  border-radius: 4px;
    }
    ion-item.side_tabs{
        --ion-background-color: #8f15f4;
        border-radius: 4px;
        margin-top: 4px;
    }
    ion-item.active
    {
    --ion-background-color: #b88eed;
        border-radius: 4px; 
    }
    ion-list.side_list
    {
        --ion-background-color: #8f15f4;
    }
    .side_icons
    {
        font-size: 25px; color: white; margin-top: 15px
    }
    .side_label
    {
        position: relative; left: 15px;bottom: 5px; color: white; font-size: 14px
    }
    a.navlink:hover
    {
        color: black;
    }
    a.navlink
    {
        color: grey;
    }
    :root {

        --input-color: #99A3BA;
        --input-border: #CDD9ED;
        --input-background: #fff;
        --input-placeholder: #CBD1DC;
    
        --input-border-focus: #275EFE;
    
    }
    
    .form-field {
        display: block;
        width: 100%;
        padding: 8px 16px;
        line-height: 25px;
        font-size: 14px;
        font-weight: 500;
        font-family: inherit;
        border-radius: 6px;
        -webkit-appearance: none;
        color: var(--input-color);
        border: 1px solid var(--input-border);
        background: var(--input-background);
        transition: border .3s ease;
        &::placeholder {
            color: var(--input-placeholder);
        }
        &:focus {
            outline: none;
            border-color: var(--input-border-focus);
        }
    }
    
  </style>
</head>
<body>
  <ion-app>
      <ion-content>
      
      <ion-grid class="ion-no-padding">
        <ion-row  style="height: 1000px">
            <ion-col class="ion-no-padding" size='2.035' style="background-color: #8f15f4;">
                <ion-row style="height: 63px">
                    <ion-col style="border-bottom: 1px solid rgba(255, 255, 255, 0.2)">
                        <label style="position: relative; left: 45px; top: 20px; weight: 500; font-weight: 400; font-size: 18px; color: white;">STUDENT DASHBOARD</label>
                    </ion-col>
                </ion-row>
                <ion-row>
                    <ion-col>
                        <ion-list class="side_list" class="ion-no-padding" style="margin-top: 20px; margin-left: 15px; margin-right: 15px">
                            <ion-item lines='none' class="side_tabs" onClick="viewOption(event,'profile')" id="defaultOpen">
                                <div style="height: 57px;">
                                    <a>
                                        <ion-icon name="person-outline" class="side_icons"></ion-icon>
                                        <label class="side_label">PROFILE</label>
                                    </a>
                                </div>
                            </ion-item>
                            <ion-item lines='none' class="side_tabs" onClick="viewOption(event,'extra')">
                                <div style="height: 57px;">
                                    <a>
                                        <ion-icon name="beer-outline" class="side_icons"></ion-icon>
                                        <label class="side_label">EXTRAS</label>
                                    </a>
                                </div>
                            </ion-item>
                            <ion-item lines='none' class="side_tabs" onClick="viewOption(event,'guests')">
                                <div style="height: 57px;">
                                    <a>
                                        <ion-icon name="people-outline" class="side_icons"></ion-icon>
                                        <label class="side_label">GUESTS</label>
                                    </a>
                                </div>
                            </ion-item>
                            <ion-item lines='none' class="side_tabs" onClick="viewOption(event,'messcut')">
                                <div style="height: 57px;">
                                    <a>
                                        <ion-icon name="home-outline" class="side_icons"></ion-icon>
                                        <label class="side_label">MESS CUT</label>
                                    </a>
                                </div>
                            </ion-item>
                        
                            <ion-item lines='none' class="side_tabs"  onClick="viewOption(event,'fee')">
                                <div style="height: 57px;">
                                    <a>
                                        <ion-icon name="newspaper-outline" class="side_icons"></ion-icon>
                                        <label class="side_label">CHECK MESS FEE</label>
                                    </a>
                                </div>
                            </ion-item>

                        </ion-list>
                
                    </ion-col>
                </ion-row>

            </ion-col>
            <ion-col>
                <ion-row style="height: 63px; border-bottom: 1px solid rgba(0, 0, 0, 0.2)">
                    <ion-col size='3'>
                        <label style="position: relative; left: 350px; top: 20px; weight: 500; font-weight: 400; font-size: 19px; color: grey">MESS MANAGEMENT</label>
                    </ion-col>
                    <ion-col offset='6' size='3'>
                        <a style="color: grey; position: relative; left: 45px; top: 20px; font-size: 16px;">Change Password</a>
                        <a class="navlink" href="/accounts/logout" style="text-decoration:none; position: relative; left: 75px; top: 20px; font-size: 16px;">Logout</a>
                    </ion-col>
                </ion-row>
                <ion-row style="height: 1000px">
                    <ion-col>
                        <div>
                    
                

                        <div id="profile" class="tabcontent" style="display:none;position: absolute;left: 100px">
                        <h1 style="position: relative;left:50px">Personal Information</h1>
                        <br>
                        
                      
                      <ion-card style = "width: 700px">

                        <ion-card-container>
                         <br>
                        <ion-list lines="none">
                            <ion-item>
                                
                                <ion-col>
                                <ion-label>
                                   &emsp;&emsp;&emsp; Name    
                                </ion-label>
                                </ion-col>
                                <ion-col>
                                    :
                                </ion-col>
                                <ion-col>
                                <%= @student.name%>
                                
                                </ion-col>
                            </ion-item>

                            <ion-item>
                                
                                <ion-col>
                                <ion-label>
                                   &emsp;&emsp;&emsp;Roll No    
                                </ion-label>
                                </ion-col>
                                <ion-col>
                                    :
                                </ion-col>
                                <ion-col>
                                <%= @student.rollno%>
                                
                                </ion-col>
                            </ion-item>

                            <ion-item>
                                
                                <ion-col>
                                <ion-label>
                                   &emsp;&emsp;&emsp;E-Mail   
                                </ion-label>
                                </ion-col>
                                <ion-col>
                                    :
                                </ion-col>
                                <ion-col>
                                <%= @student.email%>
                                
                                </ion-col>
                            </ion-item>

                            <ion-item>
                                
                                <ion-col>
                                
                                   &emsp;&emsp;&emsp;Mess Code    
                                
                                </ion-col>
                                <ion-col>
                                    :
                                </ion-col>
                                <ion-col>
                                <%= @student.mess_id%>
                                
                                </ion-col>
                            </ion-item>

                            <ion-item>
                                
                                <ion-col>
                                
                                   &emsp;&emsp;&emsp;Room No    
                                
                                </ion-col>
                                <ion-col>
                                    :
                                </ion-col>
                                <ion-col>
                                <%= @student.roomno%>
                                
                                </ion-col>
                            </ion-item>

                        </ion-list>
                        
                        </ion-card-container>
                        <br>
                        </ion-card>

                    </div>

                    <div id="guests" class="tabcontent" style="display:none;position: absolute;left: 60px">
                    <h1 style="position: relative;left:50px">MY GUEST LIST</h1>
                    <br>
                        
                        
                    <div id="s2">
                    
                    <ion-col></ion-col><ion-col>
                    <div style="position:relative;left:110px;right:400px;">
                    <ion-button id="getguest" onClick="getGuests()" style = "width:400px;height:40px;background-color: #8f15f4;color:white;" color="#8f15f4">GET GUEST LIST</ion-button>
                   </div></ion-col>
                    <div id="guestz" style="position: relative;left:100px;"></div>
                    
                    </div>
                    
                    <br>
                    </div>

                    <div id="staff_list" class="tabcontent" style="display:none;">
                    <h3>Staff List</h3>
                    <p>List of all staff goes here</p> 
                    </div>

                    <div id="messcut" class="tabcontent" style="display:none;position: absolute;left: 60px">
                    <h1 style="position: relative;left:50px">Mess Cut Entry</h1>
                    <br>
                    <ion-card style="width:900px;">
                        <br>
                        <ion-card-container>
                        <form id="myform">
                            <ion-list lines="none">
                                <ion-item>
                                    <ion-col>
                                    
                                        From Date&emsp;
                                    </ion-col>
                                    <ion-col>
                                        <input  type="date"  id="messcut[from_date]" name="pickup_date" onchange="cal()" format="dd/mm/yyyy" class="form-field">
                                    
                                    </ion-col>
                                    <ion-col>
                                        &emsp;To Date&emsp;
                                    </ion-col>
                                    <ion-col>
                                        <input  type="date" id="messcut[to_date]" name="dropoff_date" onchange="cal()" format="dd/mm/yyyy" class="form-field">
                                    </ion-col>
                                    
                                    <ion-col>
                                       &emsp; No Of Days&emsp;
                                    </ion-col>
                                    <ion-col>
                                    <input type="text" class="form-field" id="messcut[no_of_days]" name="numdays"/>
                                    </ion-col>
                                </ion-item>

             
                            

                                <br>
                            <ion-item>
                            <ion-col></ion-col>
                            
                            <ion-col>
                            <ion-button id="submit" onClick="post('/student/messcut',postData('form-field'),onMessCut);" style = "width:200px;height:40px;background-color: #8f15f4;color:white;" color="#8f15f4">SUBMIT</ion-button>
                            </ion-col>
                            <ion-col>
                            <ion-button id="reset" type="reset" style = "width:200px;height:40px;background-color: #8f15f4;color:white;" color="#8f15f4">RESET</ion-button>
                            </ion-col>
                            <ion-col></ion-col>
                            </ion-item>
                            </ion-list>
                            </form>
                        </ion-card-container>
                        <br>
                    </ion-card>
                    </div>

                    
                    <div id="extra" class="tabcontent" style="display:none;position: absolute;left: 60px">
                    <h1 style="position: relative;left:50px">MY EXTRAS</h1>
                        <br>
                        
                        
                        <div id="s1">
                        
                        <ion-col></ion-col><ion-col>
                        <div style="position:relative;left:110px;right:400px;">
                        <ion-button id="getextra" onClick="getExtra()" style = "width:400px;height:40px;background-color: #8f15f4;color:white;" color="#8f15f4">GET MY EXTRAS</ion-button>
                       </div></ion-col>
                        <div id="extras" style="position: relative;left:100px;"></div>
                        
                        </div>
                        
                        <br>
                    </div>

                    
                    <div id="fee" class="tabcontent" style="display:none;">
                    <h3>Fee</h3>
                    <p>Updates about mess fee happens here</p>
                    </div>
                </div>
                    </ion-col>
                </ion-row>
            </ion-col>
        </ion-row>
      </ion-grid>
    </ion-content>
  </ion-app>
</body>
<script>

function getExtra(){
    var txt="",i,sum=0;
    var xmlhttp = new XMLHttpRequest();

    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var myObj = JSON.parse(this.responseText);
            if(myObj.data.length==0)
            {
                txt += "<p id='noMatch' style='text-align:center;display:none;'>No matching students</p>"
            }
            else
            {
                txt+="<br><ion-card style='width:700px'><ion-card-container><ion-list><ion-card-header><ion-item><ion-col>S.No</ion-col><ion-col>Item</ion-col><ion-col>Price</ion-col></ion-item></ion-card-header>"
                for(i=0;i<myObj.data.length-1;i++)
                {
                    sum+=myObj.data[i].price;
                    txt+="<ion-item lines='none' ><ion-col>"+(i+1)+"."+"</ion-col><ion-col>"+myObj.data[i].item+"</ion-col><ion-col>"+myObj.data[i].price+".00"+"</ion-col></ion-item>"
                }
                sum+=myObj.data[i].price;
                txt+="<ion-item><ion-col>"+(i+1)+"."+"</ion-col><ion-col>"+myObj.data[i].item+"</ion-col><ion-col>"+myObj.data[i].price+".00"+"</ion-col></ion-item></ion-list><ion-list><ion-card-footer><ion-item><ion-col></ion-col><ion-col>Total Amount</ion-col><ion-col>"+sum+".00"+"</ion-col></ion-item></ion-card-footer></ion-list></ion-card-container></ion-card>"
                document.getElementById("extras").innerHTML = txt;
                console.log(sum);

            }
        }
    };
    xmlhttp.open("GET",'/extradata', true);
    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xmlhttp.send();

}

function getGuests(){
    var txt="",i;
    var xmlhttp = new XMLHttpRequest();

    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var myObj = JSON.parse(this.responseText);
            if(myObj.data.length==0)
            {
                txt += "<p id='noMatch' style='text-align:center;display:none;'>No matching students</p>"
            }
            else
            {
                txt+="<br><ion-card style='width:700px'><ion-card-container><ion-list><ion-card-header><ion-item><ion-col>S.No</ion-col><ion-col>Guest Name</ion-col><ion-col>Guest Roll No</ion-col></ion-item></ion-card-header>"
                for(i=0;i<myObj.data.length-1;i++)
                {
                  
                    txt+="<ion-item lines='none' ><ion-col>"+(i+1)+"."+"</ion-col><ion-col>"+myObj.data[i].name+"</ion-col><ion-col>"+myObj.data[i].rollno+"</ion-col></ion-item>"
                }
                console.log(txt);
                txt+="<ion-item lines='none'><ion-col>"+(i+1)+"."+"</ion-col><ion-col>"+myObj.data[i].name+"</ion-col><ion-col>"+myObj.data[i].rollno+"</ion-col></ion-item></ion-list></ion-card-container></ion-card>"
                document.getElementById("guestz").innerHTML = txt;
              

            }
        }
    };
    xmlhttp.open("GET",'/guestlist', true);
    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xmlhttp.send();

}

function GetDays(){
    var dropdt = new Date(document.getElementById("messcut[to_date]").value);
    var pickdt = new Date(document.getElementById("messcut[from_date]").value);
    return parseInt((dropdt - pickdt) / (24 * 3600 * 1000));
}

function cal(){
if(document.getElementById("messcut[to_date]")){
document.getElementById("messcut[no_of_days]").value=GetDays();
}  
}


function viewOption(evt, option) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("side_tabs");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace("active", "");
  }
  evt.currentTarget.className += " active";
  document.getElementById(option).style.display = "block";  
}

// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();

</script>
</html>
